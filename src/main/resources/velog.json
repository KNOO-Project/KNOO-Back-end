{
  "data": {
    "post": {
      "id": "d946fb36-1846-477c-8dc5-8f17d61b89ea",
      "title": "JPA ì§€ì—° ë¡œë”©ê³¼ JOIN FETCH",
      "released_at": "2023-02-14T13:37:03.395Z",
      "updated_at": "2023-03-27T09:21:40.042Z",
      "tags": [
        "JPA",
        "ìŠ¤í”„ë§",
        "íŒ¨ì¹˜ ì¡°ì¸"
      ],
      "body": "ì˜¤ëŠ˜ë„ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰ ì¤‘, ì˜¤ë¥˜ë¥¼ ë§ˆì£¼ì³¤ë‹¤. (JPAë¥¼ ì˜ ì•Œì§€ë„ ëª»í•˜ë©´ì„œ ë¤ë²¼ë“  ë‚˜ì˜ ì˜ëª»ì´ë‹¤..)\n\n```\nLazyInitializationException: failed to lazily initialize a collection of role: ...\n```\n\nì €ë²ˆì—ë„ ë§ˆì£¼ì³¤ë˜ ê·¸ ë…€ì„ì´ë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí•œ ë°°ê²½ì€ ì´ë ‡ë‹¤.\n\n## ì˜¤ë¥˜ ë°œìƒ ë°°ê²½\n\në„ì„œì˜ íƒœê·¸ê°€ ë¶™ëŠ”ë° ë„ì„œì™€ íƒœê·¸ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ì´ë‹¤. ê·¸ë˜ì„œ `BookTag`ë¼ëŠ” ì—”í‹°í‹°ë¡œ ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ í’€ê³  `BookTag` ì—”í‹°í‹°ë¥¼ ì¶”ê°€í–ˆë‹¤. (`Book`ì€ `BookTag`ì™€ ì¼ëŒ€ë‹¤ ê´€ê³„) `@OneToMany`ëŠ” ê¸°ë³¸ fetch ì „ëµì´ Lazyì¸ ê²ƒì€ ì•ˆë‹¤.\n\n```java\n@Entity\n@Getter\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\npublic class Book {\n\n    ...\n\n    @OneToMany(mappedBy = \"book\")\n    private final List<BookTag> bookTags = new ArrayList<>();\n\n    ...\n}\n```\n\n<br/>\n\n`Book`ì˜ `bookTags`ë¥¼ ë°›ì•„ `BookTag` ê°ì²´ì—ì„œ `Tag`ë¥¼ êº¼ë‚´ ì´ë¦„ì„ ë‹¤ì‹œ ë¦¬ìŠ¤íŠ¸ì— ë‹´ëŠ” ë¡œì§ì´ë‹¤. ì—¬ê¸°ì„œ `BookTag` ê°ì²´ë¥¼ ë¦¬ìŠ¤íŠ¸ì—ì„œ êº¼ë‚¼ ë•Œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.\n\n```java\n...\n\n@Override\npublic List<String> listConvertBookTagToString(List<BookTag> bookTags) {\n    List<String> tags = new ArrayList<>();\n    bookTags.forEach(bookTag -> { // ì´ ë¶€ë¶„\n        String tagName = bookTag.getTag().getTagName();\n        tags.add(tagName);\n    });\n    return tags;\n}\n\n...\n```\n\n<br/>\n\n\níŒ¨ì¹˜ ì „ëµì„ Eagerë¡œ ë°”ê¿”ì£¼ë©´ ì˜ ì¡°íšŒê°€ ëì§€ë§Œ ë¶„ëª…íˆ ì´ ë°©ë²•ì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ ê²ƒì´ë‹¤. (ëŠë‚Œì´ ë§í•´ì¤€ë‹¤.)\n\nê·¸ë‚˜ë§ˆ ìµœê·¼ì— JPA ê°•ì˜ë¥¼ ë“¤ìœ¼ë©° ê³µë¶€ ì¤‘ì´ì—ˆëŠ”ë° ì´ ë¶€ë¶„ì— ëŒ€í•´ ê°•ì‚¬ë‹˜ê»˜ì„œ íŒ¨ì¹˜ ì¡°ì¸ì´ë‚˜ ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥(?) ë“±ì„ í†µí•´ í•´ê²°ì´ ê°€ëŠ¥í•˜ë‹¤ê³  í•˜ì…¨ë˜ ê¸°ì–µì´ ë‚¬ë‹¤. ê·¸ë˜ì„œ fetch joinì„ ì—´ì‹¬íˆ ê²€ìƒ‰í•´ ë³´ê³  ì ìš©í•´ ë´¤ë‹¤.\n\n> **íŒ¨ì¹˜ ì¡°ì¸ì€ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ, JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë¼ê³  í•œë‹¤.**\n> \n\n<br/>\n\n## ì—´ì‹¬íˆ í•´ê²°í•´ ë³´ì!\n\n`Repository`ì— `@Query` ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ fetch join ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ ë´¤ë‹¤. \n\n`SELECT b FROM Book b JOIN FETCH b.bookTags WHERE b.id = :bookId`\n\n```java\n...\n\npublic interface BookRepository extends JpaRepository<Book, Long> {\n\n\t...\n\n\t@Query(\"SELECT b FROM Book b JOIN FETCH b.bookTags WHERE b.id = :bookId\")\n\tOptional<Book> findByIdFetchJoin(@Param(\"bookId\") Long id);\n\n\t...\n\n}\n```\n\n<br/>\n\nê¸°ëŒ€ë¥¼ í’ˆê³  ìš”ì²­ì„ ë³´ë‚´ ë³´ì•˜ë‹¤..! (ë‘ê·¼ë‘ê·¼..) í•˜ì§€ë§Œ ëŒì•„ì˜¤ëŠ” ê²ƒì€ `LazyInitializationException`\n\ní•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” ì˜¤ë¥˜ ë‚´ìš©ì´ ì¡°ê¸ˆ ë‹¬ëë‹¤.\n\n```\ncould not initialize proxy [knu.networksecuritylab.appserver.entity.book.Tag#2]\n```\n\n<br/>\n\n`@xToOne` ì—°ê´€ê´€ê³„ ë§¤í•‘ì˜ ê²½ìš° ê¸°ë³¸ íŒ¨ì¹˜ ì „ëµì´ Eagerë¼ì„œ Lazyë¡œ ì„¤ì •í•´ ë‘ì—ˆê¸° ë•Œë¬¸ì— `BookTag`ì˜ `Tag`ë„ í•¨ê»˜ íŒ¨ì¹˜ ì¡°ì¸ì„ í•´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.\n\n```java\n@Entity\n@Getter\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\npublic class BookTag {\n\n    ...\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"tag_id\")\n    private Tag tag;\n\n    ...\n}\n```\n\n<br/>\n\nì´ë ‡ê²Œ `JOIN FETCH`ë¥¼ ë‘ ë²ˆ ì¨ì„œ í•´ê²°ì´ ê°€ëŠ¥í–ˆë‹¤ ã…ã…\n\n```java\n...\n\npublic interface BookRepository extends JpaRepository<Book, Long> {\n\n\t...\n\n\t@Query(\"SELECT b FROM Book b JOIN FETCH b.bookTags bt JOIN FETCH bt.tag WHERE b.id = :bookId\")\n\tOptional<Book> findByIdFetchJoin(@Param(\"bookId\") Long id);\n\n\t...\n\n}\n```\n\nì•„ë‹ˆë‹¤. í•´ê²°ì´ ì•ˆ ëë‹¤. ë§Œì•½ íƒœê·¸ê°€ ì—†ëŠ” ì±…ì„ ì¡°íšŒí•˜ë©´ â€˜í•´ë‹¹ ë„ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.â€™ë¼ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤. (`null`ì¸ ê²½ìš°ì— í•´ë‹¹ ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ë„ë¡ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•´ë‘ì—ˆì—ˆë‹¤.)\n\n<br/>\n\në‚œ ì•„ê¹Œ ê·¸ ì˜¤ë¥˜ë³´ë‹¤ ì´ ì˜¤ë¥˜ê°€ ë” ê³¨ì¹˜ ì•„íŒ ë‹¤ ã…‹ã…‹ã…‹ã…‹\n\nì´ìœ ë¥¼ ì°¾ì•˜ë‹¤. ì¿¼ë¦¬ë¬¸ì„ ë³´ë‹ˆ inner joinìœ¼ë¡œ ë‚ ì•„ê°„ë‹¤. inner joinì´ë©´ ì–‘ìª½ í…Œì´ë¸”ì— ê°’ì´ ìˆì–´ì•¼ ì¡°íšŒë˜ëŠ” ê²ƒì€ ëŒ€í•™êµ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì—… ë•Œ ë°°ì› ì—ˆë‹¤. ì™¼ìª½ í…Œì´ë¸”ì´ ê¸°ì¤€ì´ ë˜ì–´ì•¼ í•˜ë‹ˆê¹Œ left joinìœ¼ë¡œ ë‚ ì•„ê°€ì•¼ ì œëŒ€ë¡œ ì¡°íšŒë  ê²ƒì´ë‹¤. ê·¼ë° left ì¡°ì¸ìœ¼ë¡œ ì–´ë–»ê²Œ í•˜ì§€..\n\n\n<p align=\"center\">\n  <img src=\"https://velog.velcdn.com/images/jcw1031/post/af2e7765-7b71-41b1-9e0b-78cb4e887842/image.png\" width=\"90%\"/>\n</p>\n\n\n> [https://www.logicbig.com/tutorials/java-ee-tutorial/jpa/fetch-join.html](https://www.logicbig.com/tutorials/java-ee-tutorial/jpa/fetch-join.html)\n> \n\nê·¸ëƒ¥ `LEFT JOIN FETCH`ë¼ê³  ì‘ì„±í•˜ë©´ ëœë‹¨ë‹¤. ë©ì²­í•˜ê²Œ `JOIN FETCH`ê°€ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¼ëŠ” ê³ ì •ê´€ë…ì— `LEFT JOIN`ì´ë¼ê³  ì‘ì„±í•  ìƒê°ì„ ëª» í–ˆë‹¤.\n\n<br/>\n\nì§„ì§œ ìµœì¢… ì½”ë“œ! (ì ì  ê¸¸ì–´ì§€ëŠ” ì¿¼ë¦¬..)\n\n```java\n...\n\npublic interface BookRepository extends JpaRepository<Book, Long> {\n\n\t...\n\n\t@Query(\"SELECT b FROM Book b LEFT JOIN FETCH b.bookTags bt LEFT JOIN FETCH bt.tag WHERE b.id = :bookId\")\n\tOptional<Book> findByIdFetchJoin(@Param(\"bookId\") Long id);\n\n\t...\n\n}\n```\n\nì´ì   ì±…ì´ ì˜ ì¡°íšŒëœë‹¤ ã…ã…ğŸ˜†\n\n---\n\nì•„ì§ ì˜ë¬¸ì´ í•˜ë‚˜ ë‚¨ì•˜ë‹¤. ë‚´ ìƒê°ì—ëŠ” `BookTag`ì™€ `Tag` íŒ¨ì¹˜ ì¡°ì¸ ì‹œì—ëŠ” left joinì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë  ê²ƒ ê°™ì•„ì„œ ê·¸ëƒ¥ `JOIN FETCH`ë¥¼ ì‚¬ìš©í•´ ë´¤ëŠ”ë° íƒœê·¸ê°€ ì—†ëŠ” ì±…ì€ ì¡°íšŒê°€ ë˜ì§€ ì•Šì•˜ë‹¤. ì´ ë¶€ë¶„ì€ ì—´ì‹¬íˆ ê³ ë¯¼í•´ ë³´ê³  í•´ê²°í•˜ë©´ ì¶”ê°€ë¡œ ì‘ì„±í•´ì•¼ê² ë‹¤.\n\n> 2023ë…„ 02ì›” 16ì¼ 00ì‹œ 12ë¶„\n\në§¤ìš° ê°„ë‹¨í•œ ì´ìœ ì˜€ë‹¤. ë‚œ ë‹¹ì—°íˆ ë’¤ì— ìˆëŠ” ì¡°ì¸ì´ ìˆ˜í–‰ë˜ê³  ì´í›„ì— ì•ì— ìˆëŠ” ì¡°ì¸ì´ ìˆ˜í–‰ë  ê²ƒì´ë¼ê³  ìƒê°í–ˆëŠ”ë° ì•„ë‹ˆì—ˆë‹¤. ì•ì˜ ì¡°ì¸ì´ ë¨¼ì € ìˆ˜í–‰ë˜ê³  ë’¤ì˜ ì¡°ì¸ì´ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì— ë’¤ì˜ ì¡°ì¸ë„ `LEFT JOIN`ì´ ë˜ì–´ì•¼ í–ˆë˜ ê²ƒì´ë‹¤.ğŸ˜…",
      "short_description": "ì•—! ì•¼ìƒì˜ LazyInitializationException(ì´)ê°€ ë‚˜íƒ€ë‚¬ë‹¤! íŒ¨ì¹˜ ì¡°ì¸ ê³µê²©",
      "is_markdown": true,
      "is_private": false,
      "is_temp": false,
      "thumbnail": "https://velog.velcdn.com/images/jcw1031/post/b4cfb8c3-104d-4900-918d-cb95bbefed38/image.png",
      "comments_count": 0,
      "url_slug": "JPA-ì§€ì—°-ë¡œë”©ê³¼-JOIN-FETCH",
      "likes": 0,
      "liked": false,
      "user": {
        "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
        "username": "jcw1031",
        "profile": {
          "id": "b545a904-0594-4b88-a07e-d0b2e08c4afa",
          "display_name": "ì§€ì°¬ìš°",
          "thumbnail": "https://velog.velcdn.com/images/jcw1031/profile/cd372817-dbdc-4f2e-bd7b-b4525359f82b/image.jpeg",
          "short_bio": "ì¢‹ì€ ê°œë°œìê°€ ë˜ì.",
          "profile_links": {
            "url": "",
            "email": "jcw001031@gmail.com",
            "github": "jcw1031"
          },
          "__typename": "UserProfile"
        },
        "velog_config": {
          "title": "woopaca.log",
          "__typename": "VelogConfig"
        },
        "__typename": "User"
      },
      "comments": [],
      "series": {
        "id": "f1234cfc-5f3b-4629-b70e-0d5551562235",
        "name": "Knowing",
        "url_slug": "Knowing",
        "series_posts": [
          {
            "id": "f5d6214a-cc82-4726-970c-ec220018a430",
            "post": {
              "id": "57880f80-57a9-430e-a22b-5ff308248794",
              "title": "@ComponentScan ìŠ¤ìº” ë²”ìœ„",
              "url_slug": "ComponentScan",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "503aab91-dc43-46c7-a6d9-d569b9c390c8",
            "post": {
              "id": "348661e3-f69e-4bba-aff4-9721147cda0b",
              "title": "Builder íŒ¨í„´..",
              "url_slug": "Builder-íŒ¨í„´",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "61288dc0-b97c-4507-b946-433833a62a85",
            "post": {
              "id": "c986801e-b618-419b-aba4-1966e546c70e",
              "title": "ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œ @ToString",
              "url_slug": "ì–‘ë°©í–¥-ì—°ê´€ê´€ê³„-ë§¤í•‘-ì‹œ-ToString",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "37e766ca-e041-4642-be9c-e9593971e3e1",
            "post": {
              "id": "45c075b5-52a5-4ca0-a348-f485b85857bd",
              "title": "ìŠ¤í”„ë§ @ResponseBody",
              "url_slug": "ìŠ¤í”„ë§-ResponseBody",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "861692f3-defb-46c4-8636-99f03b9e6480",
            "post": {
              "id": "65717c36-6503-469e-82ae-079590d3c05e",
              "title": "@RequiredArgsConstructor",
              "url_slug": "RequiredArgsConstructor",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "10b3e32d-c5ff-42e8-b9fc-c32259c807ea",
            "post": {
              "id": "3f52ea0e-faf7-421e-bbeb-a511a8d1f42e",
              "title": "ìŠ¤í”„ë§ Redirection",
              "url_slug": "ìŠ¤í”„ë§-Redirection",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "37b3226d-d9e1-4f1c-a6e1-6c0f9ba28d10",
            "post": {
              "id": "1f55ca17-a393-449a-9314-6dd5faede5ae",
              "title": "ResponseEntity<> í•œê¸€ ê¹¨ì§",
              "url_slug": "ResponseEntity-í•œê¸€-ê¹¨ì§",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "f77ccbbd-596e-45a7-827e-68f56694cb53",
            "post": {
              "id": "d946fb36-1846-477c-8dc5-8f17d61b89ea",
              "title": "JPA ì§€ì—° ë¡œë”©ê³¼ JOIN FETCH",
              "url_slug": "JPA-ì§€ì—°-ë¡œë”©ê³¼-JOIN-FETCH",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          },
          {
            "id": "77e1bc36-9e0e-44dc-a252-98f7b67e63a7",
            "post": {
              "id": "b91f2862-2d66-4812-849c-0adbec642dad",
              "title": "JPA JOIN FETCH ì—”í‹°í‹° ì¤‘ë³µ",
              "url_slug": "JPA-JOIN-FETCH-ì—”í‹°í‹°-ì¤‘ë³µ",
              "user": {
                "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
                "username": "jcw1031",
                "__typename": "User"
              },
              "__typename": "Post"
            },
            "__typename": "SeriesPost"
          }
        ],
        "__typename": "Series"
      },
      "linked_posts": {
        "previous": {
          "id": "1f55ca17-a393-449a-9314-6dd5faede5ae",
          "title": "ResponseEntity<> í•œê¸€ ê¹¨ì§",
          "url_slug": "ResponseEntity-í•œê¸€-ê¹¨ì§",
          "user": {
            "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
            "username": "jcw1031",
            "__typename": "User"
          },
          "__typename": "Post"
        },
        "next": {
          "id": "b91f2862-2d66-4812-849c-0adbec642dad",
          "title": "JPA JOIN FETCH ì—”í‹°í‹° ì¤‘ë³µ",
          "url_slug": "JPA-JOIN-FETCH-ì—”í‹°í‹°-ì¤‘ë³µ",
          "user": {
            "id": "14e9baaf-3057-4672-ac42-cc7806e5f76f",
            "username": "jcw1031",
            "__typename": "User"
          },
          "__typename": "Post"
        },
        "__typename": "LinkedPosts"
      },
      "__typename": "Post"
    }
  }
}